<div class="list-container editor-widget">

    <script type="text/ng-template" id="widget-proxy-recursion-safe.html">
        <widget-proxy field-model="item"></widget-proxy>
    </script>

    <label>{{:: vm.fieldModel.label || vm.fieldModel.name }}</label>
    <div>
        <ul dnd-list="vm.fieldModel.value"
            dnd-drop="vm.endDrag(item, index, vm.fieldModel.value)"
            dnd-allowed-types="[vm.fieldModel.listType]">

            <li flex ng-repeat="item in vm.listFieldModels track by vm.tracker(item, $id, $index)"
                class="list-item"
                layout="row"
                dnd-draggable="item"
                dnd-dragstart="vm.startDrag($index)"
                dnd-type="vm.fieldModel.listType">

                <div flex ng-include="'widget-proxy-recursion-safe.html'"></div>

                <div>
                    <div class="remove-item list-icon-btn" ng-click="vm.removeItem($index)">
                       <i class="icon-close" title="Remove from list"></i>
                    </div>
                </div>
                <div class="sort-handle list-icon-btn" dnd-handle>
                    <div class="">
                        <i class="icon-more-vert" title="Drag to sort"></i>
                    </div>
                </div>

            </li>
        </ul>

        <div layout="row" class="add-item-row">
            <div ng-if="vm.fieldModel.listType !== 'microschema'">
                <div class="add-item list-icon-btn" ng-click="vm.addItem()" ng-hide="vm.fieldModel.value.length >= vm.fieldModel.max" title="Add item to list">
                    <i class="icon-add">
                    </i>
                </div>
            </div>

            <div ng-if="vm.fieldModel.listType === 'microschema'">
                <mh-dropdown>
                    <mh-dropdown-label>
                        <div class="add-item list-icon-btn"  ng-hide="vm.fieldModel.value.length >= vm.fieldModel.max" aria-label="Add Item">
                            <i class="icon-add"></i> <i class="icon-arrow-drop-down"></i>
                        </div>
                    </mh-dropdown-label>
                    <mh-dropdown-body>
                        <ul class="create-options">
                            <li ng-repeat="microschema in vm.fieldModel.allow"  ng-click="vm.addWidget(microschema)"><a href="#" class="a-plain">{{:: microschema }}</a></li>
                        </ul>
                    </mh-dropdown-body>
                </mh-dropdown>
            </div>
        </div>

    </div>
</div>